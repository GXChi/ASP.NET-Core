<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>后台管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="~/layui/dist/css/layui.css" rel="stylesheet" />
    <link href="~/mycss-js/css/admin.css" rel="stylesheet" />
</head>
<body class="layui-layout-body" layadmin-themealias="default">
    <div id="LAY_app" class="layadmin-tabspage-none">
        <div class="layui-layout layui-layout-admin">
            <div class="layui-header">
                <!-- 头部区域 -->
                <ul class="layui-nav layui-layout-left">
                    <li class="layui-nav-item layadmin-flexible" lay-unselect="">
                        <a href="javascript:;" layadmin-event="flexible" title="侧边伸缩">
                            <i class="layui-icon layui-icon-shrink-right" id="LAY_app_flexible"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-hide-xs" lay-unselect="">
                        <a href="~/Note/Index" target="_blank" title="前台">
                            <i class="layui-icon layui-icon-website"></i>
                        </a>
                    </li>
                </ul>
                <ul class="layui-nav layui-layout-right" lay-filter="layadmin-layout-right">
                    <li class="layui-nav-item" lay-unselect="">
                        <a lay-href="app/message/index.html" layadmin-event="message" lay-text="消息中心">
                            <i class="layui-icon layui-icon-notice"></i>
                            <!-- 如果有新消息，则显示小圆点 -->
                            <span class="layui-badge-dot"></span>
                        </a>
                    </li>
                    <li class="layui-nav-item" style="margin-right:15px">
                        <a href=""><img src="//t.cn/RCzsdCq" class="layui-nav-img">@User.Identity.Name</a>
                        <dl class="layui-nav-child">
                            <dd><a onclick="updatePassword()">修改密码</a></dd>
                            <dd><a href="@Url.Action("Index","Account")">退出登录</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>

            <!-- 侧边菜单 -->
            <div class="layui-side layui-side-menu">
                <div class="layui-side-scroll">
                    <div class="layui-logo" lay-href="home/console.html">
                        <span>后台管理</span>
                    </div>
                    <ul class="layui-nav layui-nav-tree" lay-shrink="all" id="LAY-system-side-menu" lay-filter="layadmin-system-side-menu">
                        <li data-name="user" class="layui-nav-item layui-nav-itemed">
                            <a href="javascript:;" lay-tips="用户" lay-direction="2">
                                <i class="layui-icon layui-icon-user"></i>
                                <cite>用户管理</cite>
                                <span class="layui-nav-more"></span>
                            </a>
                            <dl class="layui-nav-child">
                                <dd>
                                    <a href="@Url.Action("Index","User")" class=@(ViewData["Name"].ToString() == "用户管理" ? "layui-this": "")>用户管理</a>
                                </dd>
                                <dd>
                                    <a href="@Url.Action("Index","Authority")" class=@(ViewData["Name"].ToString() == "权限管理" ? "layui-this": "")>权限管理</a>
                                </dd>
                                <dd>
                                    <a href="@Url.Action("Index","Role")" class=@(ViewData["Name"].ToString() == "角色管理" ? "layui-this": "")>角色管理</a>
                                </dd>
                            </dl>
                        </li>
                        <li data-name="user" class="layui-nav-item layui-nav-itemed">
                            <a href="javascript:;" lay-tips="用户" lay-direction="2">
                                <i class="layui-icon layui-icon-user"></i>
                                <cite>博客管理</cite>
                                <span class="layui-nav-more"></span>
                            </a>
                            <dl class="layui-nav-child">
                                <dd>
                                    <a href="@Url.Action("Index","User")" class=@(ViewData["Name"].ToString() == "用户管理" ? "layui-this": "")>博客管理</a>
                                </dd>
                                <dd>
                                    <a lay-href="user/administrators/list.html">笔记管理</a>
                                </dd>
                                <dd>
                                    <a lay-href="user/administrators/role.html">文档管理</a>
                                </dd>
                            </dl>
                        </li>
                        <li data-name="set" class="layui-nav-item">
                            <a href="javascript:;" lay-tips="设置" lay-direction="2">
                                <i class="layui-icon layui-icon-set"></i>
                                <cite>设置</cite>
                                <span class="layui-nav-more"></span>
                            </a>
                            <dl class="layui-nav-child">
                                <dd class="layui-nav-itemed">
                                    <a href="javascript:;">系统设置<span class="layui-nav-more"></span></a>
                                    <dl class="layui-nav-child">
                                        <dd><a lay-href="set/system/website.html">网站设置</a></dd>
                                        <dd><a lay-href="set/system/email.html">邮件服务</a></dd>
                                    </dl>
                                </dd>
                                <dd class="layui-nav-itemed">
                                    <a href="javascript:;">我的设置<span class="layui-nav-more"></span></a>
                                    <dl class="layui-nav-child">
                                        <dd><a lay-href="set/user/info.html">基本资料</a></dd>
                                        <dd><a lay-href="set/user/password.html">修改密码</a></dd>
                                    </dl>
                                </dd>
                            </dl>
                        </li>

                    </ul>
                </div>
            </div>

            <!-- 页面标签 -->
            <script type="text/html" template="" lay-done="layui.element.render('nav', 'layadmin-pagetabs-nav')">
                {{# if(layui.setter.pageTabs){ }}
                <div class="layadmin-pagetabs" id="LAY_app_tabs">
                    <div class="layui-icon layadmin-tabs-control layui-icon-prev" layadmin-event="leftPage"></div>
                    <div class="layui-icon layadmin-tabs-control layui-icon-next" layadmin-event="rightPage"></div>
                    <div class="layui-icon layadmin-tabs-control layui-icon-down">
                        <ul class="layui-nav layadmin-tabs-select" lay-filter="layadmin-pagetabs-nav">
                            <li class="layui-nav-item" lay-unselect>
                                <a href="javascript:;"></a>
                                <dl class="layui-nav-child layui-anim-fadein">
                                    <dd layadmin-event="closeThisTabs"><a href="javascript:;">关闭当前标签页</a></dd>
                                    <dd layadmin-event="closeOtherTabs"><a href="javascript:;">关闭其它标签页</a></dd>
                                    <dd layadmin-event="closeAllTabs"><a href="javascript:;">关闭全部标签页</a></dd>
                                </dl>
                            </li>
                        </ul>
                    </div>
                    <div class="layui-tab" lay-unauto lay-allowClose="true" lay-filter="layadmin-layout-tabs">
                        <ul class="layui-tab-title" id="LAY_app_tabsheader">
                            <li lay-id="/"><i class="layui-icon layui-icon-home"></i></li>
                        </ul>
                    </div>
                </div>
                {{# } }}
            </script>

            <!-- 主体内容 -->
            <div class="layui-body" id="LAY_app_body">
                @RenderBody()
            </div>
        </div>
    </div>

    <script src="~/layui/dist/layui.js"></script>
    <script>
        @*function loadHtml(controller, action) {
            $.ajax({
                type: "get",
                dataType: "json",
                data: field,
                url: url,
                success: function (message) {
                    if (message == "") {
                        layer.msg('注册成功，进入后台管理系统！');
                        layer.load(1);
                        location.href = '@Url.Action("Index","Home")';
                        //window.location = '@Url.Action("Index","Home")';
                    }
                    else {
                        layer.msg(message);
                        return false;
                    }
                }, error: function (e) {
                    layer.msg("请求异常，请重试", { shift: 6 })
                }
            })
        }*@
    </script>
    @*<script>
            layui.config({
                base: '../../mycss-js/' //静态资源所在路径
            }).extend({
                index: 'js/index' //主入口模块
            }).use('index');
        </script>*@

    @*<style id="LAY_layadmin_theme">
            .layui-side-menu, .layadmin-pagetabs .layui-tab-title li:after, .layadmin-pagetabs .layui-tab-title li.layui-this:after, .layui-layer-admin .layui-layer-title, .layadmin-side-shrink .layui-side-menu .layui-nav > .layui-nav-item > .layui-nav-child {
                background-color: #20222A !important;
            }

            .layui-nav-tree .layui-this, .layui-nav-tree .layui-this > a, .layui-nav-tree .layui-nav-child dd.layui-this, .layui-nav-tree .layui-nav-child dd.layui-this a {
                background-color: #009688 !important;
            }

            .layui-layout-admin .layui-logo {
                background-color: #20222A !important;
            }
        </style><div class="layui-layer-move"></div>*@
    <script>
        layui.use('form', function () {
            var form = layui.form;
            form.verify({
                username: function (value, item) { //value：表单的值、item：表单的DOM对象
                    if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)) {
                        return '用户名不能有特殊字符';
                    }
                    if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                        return '用户名首尾不能出现下划线\'_\'';
                    }
                    if (/^\d+\d+\d$/.test(value)) {
                        return '用户名不能全为数字';
                    }

                    //如果不想自动弹出默认提示框，可以直接返回 true，这时你可以通过其他任意方式提示（v2.5.7 新增）
                    if (value === 'xxx') {
                        alert('用户名不能为敏感词');
                        return true;
                    }
                }

                //我们既支持上述函数式的方式，也支持下述数组的形式
                //数组的两个值分别代表：[正则匹配、匹配不符时的提示文字]
                , pass: [
                    /^[\S]{6,12}$/
                    , '密码必须6到12位，且不能出现空格'
                ]
                , newPassword: function (value, item) {
                    var newPassword = $("[name='newPassword']").val();
                    var rePassword = $("[name='rePassword']").val();
                    if (newPassword != rePassword) {
                        return '两次密码输入不一致';
                    }
                }
            });

            form.on('submit(passwordSubmit)', function (data) {
                $.ajax({
                    type: "post",
                    dataType: "json",
                    data: data.field,
                    url: '@Url.Action("Save", "User")',
                    success: function (message) {
                        if (message == "") {
                            layer.msg('密码修改成功');
                            parent.layer.closeAll()
                            parent.reload();
                            //$.post('Index?id=' + data.field.id);
                        }
                        else {
                            layer.msg(message);
                            return false;
                        }
                    }, error: function (e) {
                        layer.msg("请求异常，请重试", { shift: 6 })
                    }
                });
                return false;

            });
        });


        function updatePassword() {
            layer.open({
                type: 1,
                title: '修改密码',
                content: $('#passwordEdit'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                success: function (layero, index) {
                    console.log(layero, index);
                }
            });
        }

        function passWordSave()
        {

        }
    </script>
    <form class="layui-form layui-form-pane" asp-action="Save" asp-controller="User" id="passwordEdit" style="display:none">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">旧密码</label>
                <div class="layui-input-block">
                    <input type="text" name="oldPassword" required lay-verify="username" placeholder="请输入旧密码" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">新密码</label>
                <div class="layui-input-block">
                    <input type="text" name="newPassword" placeholder="请输入新密码" lay-verify="newPassword" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">确认密码</label>
                <div class="layui-input-inline">
                    <input type="text" name="rePassword" placeholder="再次输入新密码" lay-verify="newPassword" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="passwordSubmit">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</body>

</html>
